# 背景系统文档

## 概述
背景系统已集成到右下角的**设置弹窗**中，用户可以通过 Tab 切换来访问背景设置功能。

## 功能特性

### 1. 渐变背景
- **多色渐变**：支持 2-5 种颜色的渐变
- **颜色选择**：每个颜色点都可以通过颜色选择器或手动输入十六进制值调整
- **角度调节**：0-360° 可调节渐变角度
- **实时预览**：调整时实时显示效果预览
- **添加/删除**：灵活添加或删除颜色点（最少 2 个，最多 5 个）

### 2. 图片背景
- **路径输入**：用户输入本地图片文件的完整路径
- **格式支持**：PNG、JPG、WebP、GIF
- **路径格式**：支持 `file://` 协议或绝对路径
- **自动适配**：图片自动覆盖整个背景（cover）
- **预览显示**：设置后即时显示预览效果
- **持久化保存**：路径保存在配置中，刷新后依然有效

### 3. 视频背景
- **路径输入**：用户输入本地视频文件的完整路径
- **格式支持**：MP4、WebM、OGG
- **路径格式**：支持 `file://` 协议或绝对路径
- **自动播放**：视频自动循环播放，静音模式
- **自动适配**：视频自动覆盖整个背景（cover）
- **预览显示**：设置后即时显示视频预览
- **持久化保存**：路径保存在配置中，刷新后依然有效

### 4. 背景效果
可以应用以下效果（注意：视频背景仅支持透明度调节）：

- **模糊效果**：0-20px，创建毛玻璃效果（不适用于视频）
- **亮度调节**：0-200%，调整背景明暗（不适用于视频）
- **透明度**：0-100%，控制背景显隐程度（所有背景类型均支持）

### 5. 快捷操作
- **应用效果**：调整效果后点击"应用效果"按钮即时生效
- **保存渐变**：配置完渐变后点击"保存渐变背景"按钮
- **重置背景**：一键恢复到默认的浅色渐变背景

## 使用方法

### 访问背景设置
1. 点击页面右下角的**设置图标**（⚙️）
2. 在弹出的设置弹窗中，点击**背景设置** Tab
3. 现在可以自由配置背景了

### 设置渐变背景
1. 选择"渐变背景"选项卡
2. 点击颜色框或输入十六进制值修改颜色
3. 点击"+ 添加颜色"按钮添加更多颜色点
4. 拖动"角度"滑块调整渐变方向
5. 在预览框中查看效果
6. 点击"保存渐变背景"按钮应用

### 设置图片背景
1. 选择"图片背景"选项卡
2. 在文本框中输入本地图片文件的完整路径
   - 例如：`file:///C:/Users/YourName/Pictures/background.jpg`
   - 或者：`D:/Images/wallpaper.png`
3. 点击"保存图片背景"按钮应用

### 设置视频背景
1. 选择"视频背景"选项卡
2. 在文本框中输入本地视频文件的完整路径
   - 例如：`file:///C:/Users/YourName/Videos/background.mp4`
   - 或者：`D:/Videos/wallpaper.mp4`
3. 点击"保存视频背景"按钮应用
4. 视频将以静音模式自动循环播放

### 调整背景效果
1. 在"背景效果"区域拖动滑块
   - **模糊**：增加模糊度会让内容更突出（不适用于视频）
   - **亮度**：调低亮度适合浅色文字，调高适合深色文字（不适用于视频）
   - **透明度**：降低透明度让背景更淡（所有背景类型均支持）
2. 点击"应用效果"按钮使效果生效

**注意**：视频背景不支持模糊和亮度效果，因为这些效果会严重影响视频播放性能。

### 重置为默认
如果不满意当前背景，点击"重置为默认背景"按钮，会恢复到默认的浅色渐变效果。

## 技术实现

### 数据结构
```typescript
interface BackgroundConfig {
  type: 'gradient' | 'local-path' | 'file' | 'video';
  value?: string; // 本地路径、文件 blob URL 或视频 blob URL
  gradient?: {
    colors: string[];
    angle?: number;
  };
  effects: {
    blur: number; // 0-20（视频不支持）
    brightness: number; // 0-200（视频不支持）
    opacity: number; // 0-100
  };
}
```

### 组件架构
- **Background 组件**：动态渲染背景，根据配置应用样式和效果
- **SettingsModal 组件**：集成了背景设置的 Tab 界面
- **useBackground Hook**：提供背景配置的读取和更新方法

### 核心方法
```typescript
const {
  background,                    // 当前背景配置
  setGradientBackground,         // 设置渐变背景
  setFileBackground,             // 设置文件图片背景（使用 blob URL）
  setVideoBackground,            // 设置视频背景（使用 blob URL）
  updateBackgroundEffects,       // 更新效果（模糊、亮度、透明度）
  handleFileUpload,              // 处理文件上传（图片或视频）
} = useBackground();
```

### 样式应用
背景效果通过 CSS 的 `filter` 和 `opacity` 属性实现：
```css
/* 图片和渐变背景 */
filter: blur(10px) brightness(120%);
opacity: 0.8;
```

视频背景使用 HTML5 `<video>` 元素：
```tsx
<video autoPlay loop muted playsInline style={{ opacity: 0.8 }}>
  <source src={blobUrl} />
</video>
```

文件路径直接保存到配置：
```typescript
// 用户输入路径
const imagePath = 'file:///C:/Users/YourName/Pictures/background.jpg';
// 或
const imagePath = 'D:/Images/wallpaper.png';

// 保存路径
setFileBackground(imagePath); // 或 setVideoBackground(videoPath)
```

## 默认配置
系统默认使用浅色三色渐变：
- 颜色：`#E3F2FD`（浅蓝）、`#F3E5F5`（浅紫）、`#E8F5E9`（浅绿）
- 角度：135°
- 效果：无模糊、100% 亮度、100% 不透明度

## 注意事项
1. **存储方式**：图片和视频背景保存文件路径（字符串）到 localStorage
2. **文件持久性**：
   - ✅ 文件路径会持久化保存
   - ✅ 刷新页面后背景仍然可用
   - ⚠️ 文件本身需要保持在原路径不被移动或删除
   - ⚠️ 如果文件被移动或删除，背景将无法显示
3. **文件访问**：
   - ✅ 无文件大小限制
   - ✅ 不占用 localStorage 空间（只存储路径）
   - ⚠️ 需要浏览器有访问本地文件的权限
   - ⚠️ 某些浏览器可能限制 `file://` 协议的访问
4. **性能考虑**：
   - 视频背景会持续播放，可能影响性能和电池寿命
   - 视频不支持模糊和亮度滤镜，以保证流畅播放
   - 大文件加载时间较长，建议使用优化后的文件
5. **浏览器兼容性**：
   - MP4 格式兼容性最好
   - WebM 和 OGG 在某些浏览器可能不支持
6. **配置管理**：
   - 文件路径会随配置一起导出
   - 导入配置时，路径会恢复（但需要确保文件在该路径存在）
   - 重置配置时，背景会恢复为默认渐变
7. **路径格式**：
   - 支持 `file://` 协议：`file:///C:/path/to/file.jpg`
   - 支持绝对路径：`C:/path/to/file.jpg` 或 `D:/Images/bg.png`
   - Windows 路径：使用正斜杠 `/` 或反斜杠 `\` 都可以
   - 建议使用 `file://` 协议以确保兼容性

## 推荐实践
1. **渐变背景**：最稳定的选择，配置可持久保存且不占用额外空间
2. **图片背景**：
   - 路径会持久保存，刷新页面后仍然可用
   - ✅ 无文件大小限制
   - ✅ 不占用 localStorage 空间
   - ⚠️ 确保图片文件不被移动或删除
   - 建议将背景文件放在固定位置（如专门的背景文件夹）
   - 推荐分辨率：1920x1080 或更高
   - 格式推荐：PNG、JPG 或 WebP
3. **视频背景**：
   - 路径会持久保存，刷新页面后仍然可用
   - ✅ 无文件大小限制
   - ✅ 不占用 localStorage 空间
   - ⚠️ 确保视频文件不被移动或删除
   - 建议将背景文件放在固定位置
   - 推荐使用短循环视频（5-10秒）
   - 推荐分辨率：1080p 或 720p
   - 考虑使用 MP4 格式（兼容性最好）

## 相关文件
- `src/components/Background/` - 背景渲染组件
- `src/components/SettingsModal/` - 设置弹窗（包含背景设置 Tab）
- `src/hooks/useBackground.ts` - 背景管理 Hook
- `src/types/index.ts` - BackgroundConfig 类型定义
- `src/services/config.ts` - 背景配置的持久化逻辑
